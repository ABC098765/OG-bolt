// Add this rule to your existing Firestore rules, at the same level as your other top-level collections
// (after the admin_errors rule and before the final closing braces):

    // ADDRESSES: Top-level addresses collection for website compatibility
    match /addresses/{addressId} {
      allow read, write: if request.auth != null && 
        resource.data.user_id == request.auth.uid;
      allow create: if request.auth != null && 
        request.resource.data.user_id == request.auth.uid &&
        request.resource.data.keys().hasAll(['name', 'phone', 'flatNo', 'buildingName']) &&
        request.resource.data.name is string &&
        request.resource.data.phone is string &&
        request.resource.data.flatNo is string &&
        request.resource.data.buildingName is string &&
        (request.resource.data.landmark == null || request.resource.data.landmark is string);
    }